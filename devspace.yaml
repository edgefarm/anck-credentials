version: v1beta11

dependencies:

- name: k3d
  source:
    git: https://github.com/edgefarm/devspace.base
    subPath: /k3d
    branch: rework

- name: sealed-secrets
  source:
    git: https://github.com/edgefarm/devspace.base
    subPath: /sealed-secrets
    branch: rework

deployments:

- name: nats-main
  kubectl:
    kustomize: true
    kustomizeArgs: ["--enable-helm"]
    manifests:
    - ./dev/manifests/nats-main
  namespace: edgefarm-network

commands:

- name: init
  command: |-
    devspace run k3d.init
    devspace run sealed-secrets.init

profiles:
- name: user
  merge:
    deployments:
    - name: nats-sub1
      kubectl:
        kustomize: true
        kustomizeArgs: ["--enable-helm"]
        manifests:
        - ./dev/manifests/user/nats-sub1
      namespace: user-nats-sub-1
    - name: nats-sub2
      kubectl:
        kustomize: true
        kustomizeArgs: ["--enable-helm"]
        manifests:
        - ./dev/manifests/user/nats-sub2
      namespace: user-nats-sub-2
