version: v1beta11

dependencies:

- name: k3d
  source:
    git: https://github.com/edgefarm/devspace.base
    subPath: /environments/k3d
    branch: rework

- name: sealed-secrets
  source:
    git: https://github.com/edgefarm/devspace.base
    subPath: /environments/sealed-secrets
    branch: rework

commands:
- name: init
  command: |-
    devspace run update
    devspace run k3d.init
    devspace run sealed-secrets.init

- name: purge
  command: |-
    devspace run k3d.purge

- name: activate
  command: |-
    devspace run k3d.activate

- name: update
  command: |-
    devspace update dependencies

deployments:

- name: nats-main
  kubectl:
    kustomize: true
    kustomizeArgs: ["--enable-helm"]
    manifests:
    - ./dev/manifests/nats-main
  namespace: edgefarm-network

- name: crds
  kubectl:
    kustomize: true
    manifests:
    - ./dev/manifests/crds
  namespace: edgefarm-network

profiles:
- name: user
  merge:
    deployments:
    - name: nats-sub1
      kubectl:
        kustomize: true
        kustomizeArgs: ["--enable-helm"]
        manifests:
        - ./dev/manifests/user/nats-sub1
      namespace: user-nats-sub1
    - name: nats-sub2
      kubectl:
        kustomize: true
        kustomizeArgs: ["--enable-helm"]
        manifests:
        - ./dev/manifests/user/nats-sub2
      namespace: user-nats-sub2
    - name: user-network
      kubectl:
        kustomize: true
        manifests:
        - ./dev/manifests/user/user-network
      namespace: user-network
